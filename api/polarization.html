
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Polarization &#8212; VAMPIRES DPP</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=4fea3ae4a0a4ba949df0a89bbae557cc2ce861ae" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Utility" href="utility.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/scexao_logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">VAMPIRES DPP</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../quickstart.html">
   Quick-start guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pipeline.html">
   Pipeline
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tutorials/index.html">
   Tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/image_registration.html">
     Image Registration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/frame_selection.html">
     Frame Selection
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   API/Reference
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="organization.html">
     Organization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="calibration.html">
     Calibration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="frame_selection.html">
     Frame Selection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="image_registration.html">
     Image Registration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="image_processing.html">
     Image Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="utility.html">
     Utility
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Polarization
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right"><a href="https://github.com/scexao-org/vampires_dpp"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/api/polarization.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-vampires_dpp.mueller_matrices">
   Mueller calculus
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Polarization</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-vampires_dpp.mueller_matrices">
   Mueller calculus
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="module-vampires_dpp.polarization">
<span id="polarization"></span><h1>Polarization<a class="headerlink" href="#module-vampires_dpp.polarization" title="Permalink to this headline">#</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.polarization.instpol_correct">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.polarization.</span></span><span class="sig-name descname"><span class="pre">instpol_correct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stokes_cube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pQ</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pU</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.polarization.instpol_correct" title="Permalink to this definition">#</a></dt>
<dd><p>Apply instrument polarization correction to stokes cube.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stokes_cube</strong> (<em>ArrayLike</em>) – (3, …) array of stokes values</p></li>
<li><p><strong>pQ</strong> (<em>float</em><em>, </em><em>optional</em>) – I -&gt; Q contribution, by default 0</p></li>
<li><p><strong>pU</strong> (<em>float</em><em>, </em><em>optional</em>) – I -&gt; U contribution, by default 0</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(3, …) stokes cube with corrected parameters</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NDArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.polarization.measure_instpol">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.polarization.</span></span><span class="sig-name descname"><span class="pre">measure_instpol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">I</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.polarization.measure_instpol" title="Permalink to this definition">#</a></dt>
<dd><p>Use aperture photometry to estimate the instrument polarization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stokes_cube</strong> (<em>ArrayLike</em>) – Input Stokes cube (4, y, x)</p></li>
<li><p><strong>r</strong> (<em>float</em><em>, </em><em>optional</em>) – Radius of circular aperture in pixels, by default 5</p></li>
<li><p><strong>expected</strong> (<em>float</em><em>, </em><em>optional</em>) – The expected fractional polarization, by default 0</p></li>
<li><p><strong>**kwargs</strong> – </p></li>
<li><p><strong>I</strong> (<em>Union</em><em>[</em><em>_SupportsArray</em><em>[</em><em>dtype</em><em>[</em><em>Any</em><em>]</em><em>]</em><em>, </em><em>_NestedSequence</em><em>[</em><em>_SupportsArray</em><em>[</em><em>dtype</em><em>[</em><em>Any</em><em>]</em><em>]</em><em>]</em><em>, </em><em>bool</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, </em><em>complex</em><em>, </em><em>str</em><em>, </em><em>bytes</em><em>, </em><em>_NestedSequence</em><em>[</em><em>Union</em><em>[</em><em>bool</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, </em><em>complex</em><em>, </em><em>str</em><em>, </em><em>bytes</em><em>]</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>X</strong> (<em>Union</em><em>[</em><em>_SupportsArray</em><em>[</em><em>dtype</em><em>[</em><em>Any</em><em>]</em><em>]</em><em>, </em><em>_NestedSequence</em><em>[</em><em>_SupportsArray</em><em>[</em><em>dtype</em><em>[</em><em>Any</em><em>]</em><em>]</em><em>]</em><em>, </em><em>bool</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, </em><em>complex</em><em>, </em><em>str</em><em>, </em><em>bytes</em><em>, </em><em>_NestedSequence</em><em>[</em><em>Union</em><em>[</em><em>bool</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, </em><em>complex</em><em>, </em><em>str</em><em>, </em><em>bytes</em><em>]</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The instrumental polarization coefficient</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.polarization.measure_instpol_satellite_spots">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.polarization.</span></span><span class="sig-name descname"><span class="pre">measure_instpol_satellite_spots</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">I</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.polarization.measure_instpol_satellite_spots" title="Permalink to this definition">#</a></dt>
<dd><p>Use aperture photometry on satellite spots to estimate the instrument polarization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stokes_cube</strong> (<em>ArrayLike</em>) – Input Stokes cube (4, y, x)</p></li>
<li><p><strong>r</strong> (<em>float</em><em>, </em><em>optional</em>) – Radius of circular aperture in pixels, by default 5</p></li>
<li><p><strong>center</strong> (<em>Tuple</em><em>, </em><em>optional</em>) – Center of satellite spots (y, x). If None, will use the frame center. By default None</p></li>
<li><p><strong>radius</strong> (<em>float</em>) – Radius of satellite spots in pixels</p></li>
<li><p><strong>expected</strong> (<em>float</em><em>, </em><em>optional</em>) – The expected fractional polarization, by default 0</p></li>
<li><p><strong>I</strong> (<em>Union</em><em>[</em><em>_SupportsArray</em><em>[</em><em>dtype</em><em>[</em><em>Any</em><em>]</em><em>]</em><em>, </em><em>_NestedSequence</em><em>[</em><em>_SupportsArray</em><em>[</em><em>dtype</em><em>[</em><em>Any</em><em>]</em><em>]</em><em>]</em><em>, </em><em>bool</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, </em><em>complex</em><em>, </em><em>str</em><em>, </em><em>bytes</em><em>, </em><em>_NestedSequence</em><em>[</em><em>Union</em><em>[</em><em>bool</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, </em><em>complex</em><em>, </em><em>str</em><em>, </em><em>bytes</em><em>]</em><em>]</em><em>]</em>) – </p></li>
<li><p><strong>X</strong> (<em>Union</em><em>[</em><em>_SupportsArray</em><em>[</em><em>dtype</em><em>[</em><em>Any</em><em>]</em><em>]</em><em>, </em><em>_NestedSequence</em><em>[</em><em>_SupportsArray</em><em>[</em><em>dtype</em><em>[</em><em>Any</em><em>]</em><em>]</em><em>]</em><em>, </em><em>bool</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, </em><em>complex</em><em>, </em><em>str</em><em>, </em><em>bytes</em><em>, </em><em>_NestedSequence</em><em>[</em><em>Union</em><em>[</em><em>bool</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, </em><em>complex</em><em>, </em><em>str</em><em>, </em><em>bytes</em><em>]</em><em>]</em><em>]</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The instrumental polarization coefficient</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.polarization.pol_inds">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.polarization.</span></span><span class="sig-name descname"><span class="pre">pol_inds</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hwp_angs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'QQUU'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.polarization.pol_inds" title="Permalink to this definition">#</a></dt>
<dd><p>Find consistent runs of FLC and HWP states.</p>
<p>A consistent run will have either 2 or 4 files per HWP state, and will have exactly 4 HWP states per cycle. Sometimes when VAMPIRES is syncing with CHARIS a HWP state will get skipped, creating partial HWP cycles. This function will return the indices which create consistent HWP cycles from the given list of FLC states, which should already be sorted by time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hwp_angs</strong> (<em>ArrayLike</em>) – The HWP states to sort through</p></li>
<li><p><strong>n</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of files per HWP state, either 2 or 4. By default 4</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The indices for which <cite>hwp_angs</cite> forms consistent HWP cycles</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>inds</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.polarization.polarization_calibration_triplediff">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.polarization.</span></span><span class="sig-name descname"><span class="pre">polarization_calibration_triplediff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filenames</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_per_hwp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adi_sync</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.polarization.polarization_calibration_triplediff" title="Permalink to this definition">#</a></dt>
<dd><p>Return a Stokes cube using the <em>bona fide</em> triple differential method. This method will split the input data into sets of 16 frames- 2 for each camera, 2 for each FLC state, and 4 for each HWP angle.</p>
<div class="tip admonition">
<p class="admonition-title">Pupil-tracking mode</p>
<p>For each of these 16 image sets, it is important to consider the apparant sky rotation when in pupil-tracking mode (which is the default for most VAMPIRES observations). With this naive triple-differential subtraction, if there is significant sky motion, the output Stokes frame will be smeared.</p>
<p>The parallactic angles for each set of 16 frames should be averaged (<code class="docutils literal notranslate"><span class="pre">average_angle</span></code>) and stored to construct the final derotation angle vector</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filenames</strong> (<em>Sequence</em><em>[</em><em>str</em><em>]</em>) – list of input filenames to construct Stokes frames from</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError:</strong> – If the input filenames are not a clean multiple of 16. To ensure you have proper 16 frame sets, use <code class="docutils literal notranslate"><span class="pre">pol_inds</span></code> with a sorted observation table.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>(4, t, y, x) Stokes cube from all 16 frame sets.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>NDArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.polarization.radial_stokes">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.polarization.</span></span><span class="sig-name descname"><span class="pre">radial_stokes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stokes_cube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.polarization.radial_stokes" title="Permalink to this definition">#</a></dt>
<dd><p>Calculate the radial Stokes parameters from the given Stokes cube (4, N, M)</p>
<div class="math notranslate nohighlight">
\[\begin{split}Q_\phi = -Q\cos(2\theta) - U\sin(2\theta) \\
U_\phi = Q\sin(2\theta) - Q\cos(2\theta)\end{split}\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stokes_cube</strong> (<em>ArrayLike</em>) – Input Stokes cube, with dimensions (4, N, M)</p></li>
<li><p><strong>phi</strong> (<em>float</em>) – Radial angle offset in radians, by default 0</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Returns the tuple (Qphi, Uphi)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NDArray, NDArray</p>
</dd>
</dl>
</dd></dl>

<section id="module-vampires_dpp.mueller_matrices">
<span id="mueller-calculus"></span><h2>Mueller calculus<a class="headerlink" href="#module-vampires_dpp.mueller_matrices" title="Permalink to this headline">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.mueller_matrices.generic">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.mueller_matrices.</span></span><span class="sig-name descname"><span class="pre">generic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.mueller_matrices.generic" title="Permalink to this definition">#</a></dt>
<dd><p>Return a generic optic with diattenuation <code class="docutils literal notranslate"><span class="pre">epsilon</span></code> and phase retardance <code class="docutils literal notranslate"><span class="pre">delta</span></code> oriented at angle <code class="docutils literal notranslate"><span class="pre">theta</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> (<em>float</em><em>, </em><em>optional</em>) – Rotation angle of the fast-axis in radians, by default 0</p></li>
<li><p><strong>epsilon</strong> (<em>float</em><em>, </em><em>optional</em>) – Diattenuation, by default 0</p></li>
<li><p><strong>delta</strong> (<em>float</em><em>, </em><em>optional</em>) – Retardance in radians, by default 0</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(4, 4) Mueller matrix for the optic</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NDArray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">generic</span><span class="p">()</span> <span class="c1"># Identity</span>
<span class="go">array([[ 1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  1.,  0., -0.],</span>
<span class="go">       [ 0.,  0.,  1.,  0.],</span>
<span class="go">       [ 0.,  0., -0.,  1.]])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">generic</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="c1"># mirror with diatt.</span>
<span class="go">array([[ 1.     ,  0.01   ,  0.     ,  0.     ],</span>
<span class="go">       [ 0.01   ,  1.     ,  0.     , -0.     ],</span>
<span class="go">       [ 0.     ,  0.     , -0.99995,  0.     ],</span>
<span class="go">       [ 0.     ,  0.     , -0.     , -0.99995]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.mueller_matrices.hwp">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.mueller_matrices.</span></span><span class="sig-name descname"><span class="pre">hwp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.mueller_matrices.hwp" title="Permalink to this definition">#</a></dt>
<dd><p>Return the Mueller matrix for an ideal half-wave plate (HWP) with fast-axis oriented to the given angle, in radians.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>theta</strong> (<em>float</em><em>, </em><em>optional</em>) – Rotation angle of the fast-axis, in radians. By default 0</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(4, 4) Mueller matrix representing the HWP</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NDArray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hwp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([[ 1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  1.,  0.,  0.],</span>
<span class="go">       [ 0.,  0., -1.,  0.],</span>
<span class="go">       [ 0.,  0.,  0., -1.]])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hwp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">45</span><span class="p">))</span>
<span class="go">array([[ 1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0., -1.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  1.,  0.],</span>
<span class="go">       [ 0.,  0.,  0., -1.]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.mueller_matrices.linear_polarizer">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.mueller_matrices.</span></span><span class="sig-name descname"><span class="pre">linear_polarizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.mueller_matrices.linear_polarizer" title="Permalink to this definition">#</a></dt>
<dd><p>Return the Mueller matrix for an ideal linear polarizer oriented at the given angle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>theta</strong> (<em>float</em><em>, </em><em>optional</em>) – Angle of rotation, in radians. By default 0</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(4, 4) Mueller matrix for the linear polarizer</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NDArray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">linear_polarizer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([[0.5, 0.5, 0. , 0. ],</span>
<span class="go">       [0.5, 0.5, 0. , 0. ],</span>
<span class="go">       [0. , 0. , 0. , 0. ],</span>
<span class="go">       [0. , 0. , 0. , 0. ]])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">linear_polarizer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">45</span><span class="p">))</span>
<span class="go">array([[0.5, 0. , 0.5, 0. ],</span>
<span class="go">       [0. , 0. , 0. , 0. ],</span>
<span class="go">       [0.5, 0. , 0.5, 0. ],</span>
<span class="go">       [0. , 0. , 0. , 0. ]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.mueller_matrices.qwp">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.mueller_matrices.</span></span><span class="sig-name descname"><span class="pre">qwp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.mueller_matrices.qwp" title="Permalink to this definition">#</a></dt>
<dd><p>Return the Mueller matrix for an ideal quarter-wave plate (QWP) with fast-axis oriented to the given angle, in radians.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>theta</strong> (<em>float</em><em>, </em><em>optional</em>) – Rotation angle of the fast-axis in radians. By default 0</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(4, 4) Mueller matrix representing the QWP</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NDArray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qwp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([[ 1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  1.,  0., -0.],</span>
<span class="go">       [ 0.,  0.,  0.,  1.],</span>
<span class="go">       [ 0.,  0., -1.,  0.]])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qwp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">45</span><span class="p">))</span>
<span class="go">array([[ 1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  0., -1.],</span>
<span class="go">       [ 0.,  0.,  1.,  0.],</span>
<span class="go">       [ 0.,  1., -0.,  0.]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.mueller_matrices.rotator">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.mueller_matrices.</span></span><span class="sig-name descname"><span class="pre">rotator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.mueller_matrices.rotator" title="Permalink to this definition">#</a></dt>
<dd><p>Return the Mueller matrix for rotation clockwise about the optical axis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>theta</strong> (<em>float</em><em>, </em><em>optional</em>) – Angle of rotation, in radians. By default 0</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(4, 4) Mueller matrix</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NDArray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rotator</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([[ 1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  1.,  0.,  0.],</span>
<span class="go">       [ 0., -0.,  1.,  0.],</span>
<span class="go">       [ 0.,  0.,  0.,  1.]])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rotator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">45</span><span class="p">))</span>
<span class="go">array([[ 1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  1.,  0.],</span>
<span class="go">       [ 0., -1.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  0.,  1.]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.mueller_matrices.waveplate">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.mueller_matrices.</span></span><span class="sig-name descname"><span class="pre">waveplate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.mueller_matrices.waveplate" title="Permalink to this definition">#</a></dt>
<dd><p>Return the Mueller matrix for a waveplate with arbitrary phase retardance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> (<em>float</em><em>, </em><em>optional</em>) – Rotation angle of the fast-axis in radians. By default 0</p></li>
<li><p><strong>delta</strong> (<em>float</em><em>, </em><em>optional</em>) – Retardance in radians, by default 0</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(4, 4) Mueller matrix representing the waveplate</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NDArray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">waveplate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="c1"># HWP</span>
<span class="go">array([[ 1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  1.,  0., -0.],</span>
<span class="go">       [ 0.,  0., -1.,  0.],</span>
<span class="go">       [ 0.,  0., -0., -1.]])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">waveplate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">45</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># QWP at 45°</span>
<span class="go">array([[ 1.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  0., -1.],</span>
<span class="go">       [ 0.,  0.,  1.,  0.],</span>
<span class="go">       [ 0.,  1., -0.,  0.]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="vampires_dpp.mueller_matrices.wollaston">
<span class="sig-prename descclassname"><span class="pre">vampires_dpp.mueller_matrices.</span></span><span class="sig-name descname"><span class="pre">wollaston</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ordinary</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#vampires_dpp.mueller_matrices.wollaston" title="Permalink to this definition">#</a></dt>
<dd><p>Return the Mueller matrix for a Wollaston prism or polarizing beamsplitter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ordinary</strong> (<em>bool</em><em>, </em><em>optional</em>) – Return the ordinary beam’s Mueller matrix, by default True</p></li>
<li><p><strong>eta</strong> (<em>float</em><em>, </em><em>optional</em>) – For imperfect beamsplitters, the diattenuation of the optic, by default 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(4, 4) Mueller matrix for the selected output beam</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NDArray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wollaston</span><span class="p">()</span>
<span class="go">array([[0.5, 0.5, 0. , 0. ],</span>
<span class="go">       [0.5, 0.5, 0. , 0. ],</span>
<span class="go">       [0. , 0. , 0. , 0. ],</span>
<span class="go">       [0. , 0. , 0. , 0. ]])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wollaston</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="go">array([[ 0.5, -0.4,  0. ,  0. ],</span>
<span class="go">       [-0.4,  0.5,  0. ,  0. ],</span>
<span class="go">       [ 0. ,  0. ,  0.3,  0. ],</span>
<span class="go">       [ 0. ,  0. ,  0. ,  0.3]])</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="utility.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Utility</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Miles Lucas<br/>
  
      &copy; Copyright 2022, 2023, Miles Lucas.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>